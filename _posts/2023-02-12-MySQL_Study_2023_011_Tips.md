---
layout: post
title: "MySQL 8.0 Study 011 Tips"
category: MySQL
tags: MySQL Tips
---

* content
{:toc}

MySQL 8.0 Study 011 Tips

学习系列
- MySQL 主键与唯一索引的一些问题







### MySQL 主键与唯一索引的一些问题


唯一索引可能产生冗余数据

参考如下

唯一索引示例:

```
mysql [localhost:8032] {msandbox} (test) > create table t1(id int, col1 varchar(20));
Query OK, 0 rows affected (0.06 sec)

mysql [localhost:8032] {msandbox} (test) > show create table t1\G
*************************** 1. row ***************************
       Table: t1
Create Table: CREATE TABLE `t1` (
  `id` int DEFAULT NULL,
  `col1` varchar(20) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
1 row in set (0.00 sec)

mysql [localhost:8032] {msandbox} (test) > alter table t1 add unique key(id,col1);
Query OK, 0 rows affected (0.09 sec)
Records: 0  Duplicates: 0  Warnings: 0
mysql [localhost:8032] {msandbox} (test) > insert into t1 values (1,'aaa');
Query OK, 1 row affected (0.03 sec)

mysql [localhost:8032] {msandbox} (test) > insert into t1 values (1,'aaa');
ERROR 1062 (23000): Duplicate entry '1-aaa' for key 't1.id'
mysql [localhost:8032] {msandbox} (test) > insert into t1 values (1,'bbb');
Query OK, 1 row affected (0.00 sec)

mysql [localhost:8032] {msandbox} (test) > insert into t1 values (1,null);
Query OK, 1 row affected (0.01 sec)

mysql [localhost:8032] {msandbox} (test) > insert into t1 values (1,null);
Query OK, 1 row affected (0.01 sec)

mysql [localhost:8032] {msandbox} (test) > insert into t1 values (1,null);
Query OK, 1 row affected (0.01 sec)

mysql [localhost:8032] {msandbox} (test) > insert into t1 values (1,null);
Query OK, 1 row affected (0.01 sec)

mysql [localhost:8032] {msandbox} (test) > select * from t1;
+------+------+
| id   | col1 |
+------+------+
|    1 | NULL |
|    1 | NULL |
|    1 | NULL |
|    1 | NULL |
|    1 | aaa  |
|    1 | bbb  |
+------+------+
6 rows in set (0.00 sec)

mysql [localhost:8032] {msandbox} (test) > 
```

主键示例:

```
mysql [localhost:8032] {msandbox} (test) > create table t2(id int,col1 varchar(20),primary key idx_t2_pk(id,col1));
Query OK, 0 rows affected (0.04 sec)

mysql [localhost:8032] {msandbox} (test) > show create table t2\G
*************************** 1. row ***************************
       Table: t2
Create Table: CREATE TABLE `t2` (
  `id` int NOT NULL,
  `col1` varchar(20) NOT NULL,
  PRIMARY KEY (`id`,`col1`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
1 row in set (0.00 sec)

mysql [localhost:8032] {msandbox} (test) > insert into t2 values(1,'aaa');
Query OK, 1 row affected (0.01 sec)

mysql [localhost:8032] {msandbox} (test) > insert into t2 values(1,'aaa');
ERROR 1062 (23000): Duplicate entry '1-aaa' for key 't2.PRIMARY'
mysql [localhost:8032] {msandbox} (test) > insert into t2 values(1,'bbb');
Query OK, 1 row affected (0.02 sec)

mysql [localhost:8032] {msandbox} (test) > insert into t2 values(1,null);
ERROR 1048 (23000): Column 'col1' cannot be null
mysql [localhost:8032] {msandbox} (test) > 
```


null的一些思考

- 1.null与空串是不同处理方式，虽然表示为没有字符串，这两个是不同对象
- 2.count 的差异，如下示例
- 3.组合索引中null的处理方式不同
- 4.创表时候能用not null约束尽量使用，能用主键约束，就不要使用唯一索引约束

```
mysql [localhost:8032] {msandbox} (test) > select * from t1;
+------+------+
| id   | col1 |
+------+------+
|    1 | NULL |
|    1 | NULL |
|    1 | NULL |
|    1 | NULL |
|    1 | aaa  |
|    1 | bbb  |
+------+------+
6 rows in set (0.00 sec)

mysql [localhost:8032] {msandbox} (test) > select count(id) from t1;
+-----------+
| count(id) |
+-----------+
|         6 |
+-----------+
1 row in set (0.00 sec)

mysql [localhost:8032] {msandbox} (test) > select count(col1) from t1;
+-------------+
| count(col1) |
+-------------+
|           2 |
+-------------+
1 row in set (0.00 sec)

mysql [localhost:8032] {msandbox} (test) > 
```


### Referece

参考:

[MySQL在线DDL工具pt-osc](https://www.jianshu.com/p/c739d12afbef)

[pt-osc原理、限制、及与原生online-ddl比较](https://www.cnblogs.com/DataArt/p/10094105.html)

Have a good work&life! 2023/02 via LinHong


