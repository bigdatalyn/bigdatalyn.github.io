---
layout: post
title: "MySQL 8.0 Study 003 Tips"
category: MySQL
tags: MySQL Tips
---

* content
{:toc}

MySQL 8.0 Study 003 Tips

学习系列

- 组提交
- innodb_log_buffer_size

### 01. 组提交

[图解MySQL 原理解析 MySQL组提交(group commit)](https://mp.weixin.qq.com/s/_WVE1xtGdtXEcwkTf7j_rA)

WAL机制 (Write Ahead Log)定义:

```
WAL指的是对数据文件进行修改前，必须将修改先记录日志。MySQL为了保证ACID中的一致性和持久性，使用了WAL。
```

Redo log的作用:

```
Redo log就是一种WAL的应用。当数据库忽然掉电，再重新启动时，MySQL可以通过Redo log还原数据。也就是说，每次事务提交时，不用同步刷新磁盘数据文件，只需要同步刷新Redo log就足够了。相比写数据文件时的随机IO，写Redo log时的顺序IO能够提高事务提交速度。
```

组提交的作用:

在没有开启binlog时

```
Redo log的刷盘操作将会是最终影响MySQL TPS的瓶颈所在。为了缓解这一问题，MySQL使用了组提交，将多个刷盘操作合并成一个，如果说10个事务依次排队刷盘的时间成本是10，那么将这10个事务一次性一起刷盘的时间成本则近似于1。
```

当开启binlog时

```
为了保证Redo log和binlog的数据一致性，MySQL使用了二阶段提交，由binlog作为事务的协调者。而 引入二阶段提交 使得binlog又成为了性能瓶颈，先前的Redo log 组提交 也成了摆设。为了再次缓解这一问题，MySQL增加了binlog的组提交，目的同样是将binlog的多个刷盘操作合并成一个，结合Redo log本身已经实现的 组提交，分为三个阶段(Flush 阶段、Sync 阶段、Commit 阶段)完成binlog 组提交，最大化每次刷盘的收益，弱化磁盘瓶颈，提高性能。
```

### 02. innodb_log_buffer_size

MySQL 官方文档说 innodb_log_buffer_size 是 redo log 的写缓存，设置大一点能减少写操作。

```
innodb_log_buffer_size 是 redo log 的写缓存，如果 buffer 不够大，就会发生多次 IO write，将缓存中的数据刷到磁盘；
innodb_log_buffer_size 越大，IO 次数越少。
```

一般存储上，虽然 IO write 次数少了，但 write 的数据量是差不多的，所以整体的 IO 延迟总体差不多；

在好点的存储上，如果数据量差不多， write 次数越少，延迟会越低。

这也就是为什么大家在调整这个参数后, 经常会感知不到性能的提升。


### Referece

参考:

[Sysbench的安装(Build Install)](https://www.cnblogs.com/chengwaixue/p/15073864.html)



Have a good work&life! 2023/01 via LinHong


