---
layout: post
title: "MySQL 8.0 Study 007 Tips"
category: MySQL
tags: MySQL Tips
---

* content
{:toc}

MySQL 8.0 Study 007 Tips

学习系列

- MySQL 哈希分区



### MySQL 哈希分区


分区表优势:

```
分区表主要有以下几种优势：
大幅提升某些查询的性能。
简化日常数据运维工作量、提升运维效率。
并行查询、均衡写 IO 。
对应用透明，不需要在应用层部署路由或者中间层。
```

哈希分区示例:

```
create table t1_p_hash_id(
  id bigint not null auto_increment,
  col1 int default null,
  logdate date default null,
  primary key(id)
)
partition by hash(id)
partitions 100
;

select left(partition_name,5) p,sum(table_rows) cnt from information_schema.partitions where table_name = 't1_p_hash_id' group by left(partition_name,5);
```

表 t1_p_hash_id 的分区方式很好理解，按照 ID 来对数据进行 HASH 拆分，也就是按照分区数量求模， 类似于 hash(mod(id,100)) ，数据分布非常均匀。

```
SQL 1：select count(*) from t1_p_hash_id where id = 1;
SQL 2：select count(*) from t1_p_hash_id where id in (1,2,3,4,5);
SQL 3：select count(*) from t1_p_hash_id where id <=1;
SQL 4：select count(*) from t1_p_hash_id where id <=5;
```

SQL 1 和 SQL 2 非常适合检索哈希分区表，SQL 3 和 SQL 4 就不太适合。

```
mysql> explain select count(*) from t1_p_hash_id where id in (1,2,3,4,5)\G
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t1_p_hash_id
   partitions: p1,p2,p3,p4,p5
         type: index
possible_keys: PRIMARY
          key: PRIMARY
      key_len: 8
          ref: NULL
         rows: 1
     filtered: 100.00
        Extra: Using where; Using index
1 row in set, 1 warning (0.00 sec)

mysql> explain select count(*) from t1_p_hash_id where id <=25\G
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t1_p_hash_id
   partitions: p0,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19,p20,p21,p22,p23,p24,p25,p26,p27,p28,p29,p30,p31,p32,p33,p34,p35,p36,p37,p38,p39,p40,p41,p42,p43,p44,p45,p46,p47,p48,p49,p50,p51,p52,p53,p54,p55,p56,p57,p58,p59,p60,p61,p62,p63,p64,p65,p66,p67,p68,p69,p70,p71,p72,p73,p74,p75,p76,p77,p78,p79,p80,p81,p82,p83,p84,p85,p86,p87,p88,p89,p90,p91,p92,p93,p94,p95,p96,p97,p98,p99
         type: index
possible_keys: PRIMARY
          key: PRIMARY
      key_len: 8
          ref: NULL
         rows: 1
     filtered: 100.00
        Extra: Using where; Using index
1 row in set, 1 warning (0.00 sec)

mysql> 
```

非等值的 SQL 3 和 SQL 4 需要扫描全部分区，类似全表扫。

所以需要注意的是哈希分区表仅限于等值过滤检索，类似对普通表基于哈希索引的检索。


### Referece

参考:

[MySQL 分区表案例分享](https://opensource.actionsky.com/20220316-mysql/)


[MySQL全面瓦解29：分库分表之Partition功能详解](https://www.cnblogs.com/wzh2010/p/15312123.html)


Have a good work&life! 2023/01 via LinHong


