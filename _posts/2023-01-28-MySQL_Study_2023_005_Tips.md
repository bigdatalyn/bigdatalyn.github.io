---
layout: post
title: "MySQL 8.0 Study 005 Tips"
category: MySQL
tags: MySQL Tips
---

* content
{:toc}

MySQL 8.0 Study 005 Tips

学习系列

- MySQL 存储引擎
- MySQL 启动选项
- MySQL 字符集查看
- MySQL 锁相关(脏读/不可重复度/幻读)





### MySQL 存储引擎

MySQL支持的存储引擎和对应是否支持事务等信息

MySQL5.5.5开始InnoDB为默认存储引擎

创建表时候可以指定存储引擎类型

也可以通过`alter table`修改表的存储引擎类型

通过`show create table xxx`来查看表的存储引擎

```
mysql [localhost:8032] {msandbox} (test) > show engines;
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
| ndbcluster         | NO      | Clustered, fault-tolerant tables                               | NULL         | NULL | NULL       |
| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |
| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |
| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |
| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |
| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |
| ndbinfo            | NO      | MySQL Cluster system information storage engine                | NULL         | NULL | NULL       |
| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |
| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |
| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |
| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
11 rows in set (0.00 sec)

mysql [localhost:8032] {msandbox} (test) > create table test01(id int) engine=memory;
Query OK, 0 rows affected (0.08 sec)

mysql [localhost:8032] {msandbox} (test) > alter table test01 engine=innodb;
Query OK, 0 rows affected (0.12 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql [localhost:8032] {msandbox} (test) > show create table test01\G
*************************** 1. row ***************************
       Table: test01
Create Table: CREATE TABLE `test01` (
  `id` int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
1 row in set (0.00 sec)

mysql [localhost:8032] {msandbox} (test) > 
```
### MySQL 启动选项

使用下面命令查看启动项内容

```
mysqld --verbose --help
```

如:

```
  --bind-address=name IP address(es) to bind to. Syntax: address[,address]...,
                      where address can be an IPv4 address, IPv6 address, host
                      name or one of the wildcard values *, ::, 0.0.0.0. In
                      case more than one address is specified in a
                      comma-separated list, wildcard values are not allowed.
                      Every address can have optional network namespace
                      separated by the delimiter / from the address value.
                      E.g., the following value
                      192.168.1.1/red,172.16.1.1/green,193.168.1.1 specifies
                      three IP addresses to listen for incoming TCP connections
                      two of that have to be placed in corresponding
                      namespaces: the address 192.168.1.1 must be placed into
                      the namespace red and the address 172.16.1.1 must be
                      placed into the namespace green. Using of network
                      namespace requires its support from underlying Operating
                      System. Attempt to specify a network namespace for a
                      platform that doesn't support it results in error during
                      socket creation.

  --default-storage-engine=name 
                      The default storage engine for new tables

  --skip-networking   Don't allow connection with TCP/IP

```

### MySQL 字符集查看

查看MySQL字符集:
- ci 后缀说明 字符集的名称使用小写形式
- maxlen 表示最多多少个字节表示一个字符(utf8mb4 表示 4个字节)

```
mysql [localhost:8032] {msandbox} ((none)) > show charset;
+----------+---------------------------------+---------------------+--------+
| Charset  | Description                     | Default collation   | Maxlen |
+----------+---------------------------------+---------------------+--------+
| armscii8 | ARMSCII-8 Armenian              | armscii8_general_ci |      1 |
| ascii    | US ASCII                        | ascii_general_ci    |      1 |
| big5     | Big5 Traditional Chinese        | big5_chinese_ci     |      2 |
| binary   | Binary pseudo charset           | binary              |      1 |
| cp1250   | Windows Central European        | cp1250_general_ci   |      1 |
| cp1251   | Windows Cyrillic                | cp1251_general_ci   |      1 |
| cp1256   | Windows Arabic                  | cp1256_general_ci   |      1 |
| cp1257   | Windows Baltic                  | cp1257_general_ci   |      1 |
| cp850    | DOS West European               | cp850_general_ci    |      1 |
| cp852    | DOS Central European            | cp852_general_ci    |      1 |
| cp866    | DOS Russian                     | cp866_general_ci    |      1 |
| cp932    | SJIS for Windows Japanese       | cp932_japanese_ci   |      2 |
| dec8     | DEC West European               | dec8_swedish_ci     |      1 |
| eucjpms  | UJIS for Windows Japanese       | eucjpms_japanese_ci |      3 |
| euckr    | EUC-KR Korean                   | euckr_korean_ci     |      2 |
| gb18030  | China National Standard GB18030 | gb18030_chinese_ci  |      4 |
| gb2312   | GB2312 Simplified Chinese       | gb2312_chinese_ci   |      2 |
| gbk      | GBK Simplified Chinese          | gbk_chinese_ci      |      2 |
| geostd8  | GEOSTD8 Georgian                | geostd8_general_ci  |      1 |
| greek    | ISO 8859-7 Greek                | greek_general_ci    |      1 |
| hebrew   | ISO 8859-8 Hebrew               | hebrew_general_ci   |      1 |
| hp8      | HP West European                | hp8_english_ci      |      1 |
| keybcs2  | DOS Kamenicky Czech-Slovak      | keybcs2_general_ci  |      1 |
| koi8r    | KOI8-R Relcom Russian           | koi8r_general_ci    |      1 |
| koi8u    | KOI8-U Ukrainian                | koi8u_general_ci    |      1 |
| latin1   | cp1252 West European            | latin1_swedish_ci   |      1 |
| latin2   | ISO 8859-2 Central European     | latin2_general_ci   |      1 |
| latin5   | ISO 8859-9 Turkish              | latin5_turkish_ci   |      1 |
| latin7   | ISO 8859-13 Baltic              | latin7_general_ci   |      1 |
| macce    | Mac Central European            | macce_general_ci    |      1 |
| macroman | Mac West European               | macroman_general_ci |      1 |
| sjis     | Shift-JIS Japanese              | sjis_japanese_ci    |      2 |
| swe7     | 7bit Swedish                    | swe7_swedish_ci     |      1 |
| tis620   | TIS620 Thai                     | tis620_thai_ci      |      1 |
| ucs2     | UCS-2 Unicode                   | ucs2_general_ci     |      2 |
| ujis     | EUC-JP Japanese                 | ujis_japanese_ci    |      3 |
| utf16    | UTF-16 Unicode                  | utf16_general_ci    |      4 |
| utf16le  | UTF-16LE Unicode                | utf16le_general_ci  |      4 |
| utf32    | UTF-32 Unicode                  | utf32_general_ci    |      4 |
| utf8mb3  | UTF-8 Unicode                   | utf8mb3_general_ci  |      3 |
| utf8mb4  | UTF-8 Unicode                   | utf8mb4_0900_ai_ci  |      4 |
+----------+---------------------------------+---------------------+--------+
41 rows in set (0.02 sec)

mysql [localhost:8032] {msandbox} ((none)) > 
```

字符比较规则查看
- ai 不区分重音
- as 区分重音
- ci 不区分大小写
- cs 区分大小写
- bin 二进制比较

```
mysql [localhost:8032] {msandbox} ((none)) > show collation;
mysql [localhost:8032] {msandbox} ((none)) > show collation like 'utf8mb4\_%';
+----------------------------+---------+-----+---------+----------+---------+---------------+
| Collation                  | Charset | Id  | Default | Compiled | Sortlen | Pad_attribute |
+----------------------------+---------+-----+---------+----------+---------+---------------+
| utf8mb4_0900_ai_ci         | utf8mb4 | 255 | Yes     | Yes      |       0 | NO PAD        |
| utf8mb4_0900_as_ci         | utf8mb4 | 305 |         | Yes      |       0 | NO PAD        |
| utf8mb4_0900_as_cs         | utf8mb4 | 278 |         | Yes      |       0 | NO PAD        |
| utf8mb4_0900_bin           | utf8mb4 | 309 |         | Yes      |       1 | NO PAD        |
```

服务器级别字符集和比较规则

```
mysql [localhost:8032] {msandbox} ((none)) > show variables like 'character%';
+--------------------------+-----------------------------------+
| Variable_name            | Value                             |
+--------------------------+-----------------------------------+
| character_set_client     | utf8mb4                           |
| character_set_connection | utf8mb4                           |
| character_set_database   | utf8mb4                           |
| character_set_filesystem | binary                            |
| character_set_results    | utf8mb4                           |
| character_set_server     | utf8mb4                           |
| character_set_system     | utf8mb3                           |
| character_sets_dir       | /opt/mysql/8.0.32/share/charsets/ |
+--------------------------+-----------------------------------+
8 rows in set (0.00 sec)

mysql [localhost:8032] {msandbox} ((none)) > show variables like 'collation%';
+----------------------+--------------------+
| Variable_name        | Value              |
+----------------------+--------------------+
| collation_connection | utf8mb4_0900_ai_ci |
| collation_database   | utf8mb4_0900_ai_ci |
| collation_server     | utf8mb4_0900_ai_ci |
+----------------------+--------------------+
3 rows in set (0.00 sec)

mysql [localhost:8032] {msandbox} ((none)) > 
```

### MySQL 锁相关(脏读/不可重复度/幻读)

脏读
```
当前事务读取到另外一个事务未提交的一条记录
如果另外一个事务在写的时候给记录加上锁，当前事务就无法读取该记录时再获取到锁，就不会出现脏读
```

不可重复读
```
当前事务先读取一条记录，另外一个事务对该记录就行修改。当前事务再次读取到不同的记录。
如果当前事务读取该记录时候加锁，另外一个事务就无法修改改记录。
```

幻读
```
当前事务读取了某些条件的记录，之后别的事务又插入符合相同条件的新记录，导致当前事务再次读取相同条件记录时候，可以读到别的事务插入的新记录
```

读读情况不会引起什么问题，对于写写，读写，写读情况，可能会引起一些问题，这时候需要MVCC(多版本控制)或者加锁方式来解决。

### Referece

参考:


[MySQL 千万数据量深分页优化, 拒绝线上故障](https://blog.csdn.net/qq_37781649/article/details/111689193)

[MySQL大数据量分页查询方法及其优化](https://www.cnblogs.com/geningchao/p/6649907.html)



Have a good work&life! 2023/01 via LinHong


