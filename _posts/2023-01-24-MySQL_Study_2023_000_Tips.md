---
layout: post
title: "MySQL 8.0 Study 000 Tips"
category: MySQL
tags: MySQL scripts Tips
---

* content
{:toc}

MySQL 8.0 Study 000 Tips

常用sql

- MySQL 对象容量查看sql



### MySQL 对象容量查看sql


1.查看所有数据库各容量大小

```
select
table_schema as '数据库',
sum(table_rows) as '记录数',
sum(truncate(data_length/1024/1024, 2)) as '数据容量(MB)',
sum(truncate(index_length/1024/1024, 2)) as '索引容量(MB)'
from information_schema.tables
group by table_schema
order by sum(data_length) desc, sum(index_length) desc;
```

2.查看所有数据库各表容量大小

```
select
table_schema as '数据库',
table_name as '表名',
table_rows as '记录数',
truncate(data_length/1024/1024, 2) as '数据容量(MB)',
truncate(index_length/1024/1024, 2) as '索引容量(MB)'
from information_schema.tables
order by data_length desc, index_length desc;
```

3.查看指定数据库容量大小

例：查看mysql库容量大小
```
select
table_schema as '数据库',
sum(table_rows) as '记录数',
sum(truncate(data_length/1024/1024, 2)) as '数据容量(MB)',
sum(truncate(index_length/1024/1024, 2)) as '索引容量(MB)'
from information_schema.tables
where table_schema='mysql';
```

4.查看指定数据库各表容量大小
例：查看mysql库各表容量大小
```
select
table_schema as '数据库',
table_name as '表名',
table_rows as '记录数',
truncate(data_length/1024/1024, 2) as '数据容量(MB)',
truncate(index_length/1024/1024, 2) as '索引容量(MB)'
from information_schema.tables
where table_schema='mysql'
order by data_length desc, index_length desc;
```

### Mysqladmin 查看QPS

```
mysqladmin -ulin -h127.0.0.1 -P8032 -p'mysql' extended-status -i1 | awk '/Queries/{q=$4-qp;qp=$4} /Threads_connected/{tc=$4} /Threads_running/{printf "%5d %5d %5d\n",q,tc,$4}'

第一列：每秒查询量   
第二列：链接数
第三列：当前执行的链接数
```

```
mysqladmin -uroot -h127.0.0.1 -P8032 -p'mysql' extended-status -i1|awk 'BEGIN{local_switch=0;print "-------- Time -------| QPS   Commit Rollback   TPS    Threads_con Threads_run \n----------------------------------------------------------------------------- "}
    $2 ~ /Queries$/            {q=$4-lq;lq=$4;}
    $2 ~ /Com_commit$/         {c=$4-lc;lc=$4;}
    $2 ~ /Com_rollback$/       {r=$4-lr;lr=$4;}
    $2 ~ /Threads_connected$/  {tc=$4;}
    $2 ~ /Threads_running$/    {tr=$4;
    if(local_switch==0)
            {local_switch=1; count=0}
    else {
            if(count>10){
                    count=0;
                    print "-----------------------------------------------------------------------------";
                    print "-------- Time -------| QPS   Commit Rollback   TPS    Threads_con Threads_run";
                    print "----------------------------------------------------------------------------- ";
                    }
            else{
                    count+=1;
                    printf "%s | %-6d %-8d %-7d %-8d %-10d %d \n", strftime("%Y/%m/%d/ %H:%M:%S"),q,c,r,c+r,tc,tr;
            }
    }
}'


mysqladmin -uroot -h127.0.0.1 -P8032 -p'mysql' extended-status -i1|awk 'BEGIN{local_switch=0}
     $2 ~ /Queries$/            {q=$4-lq;lq=$4;}
     $2 ~ /com_commit$/         {c=$4-lc;lc=$4;}
     $2 ~ /Com_rollback$/       {r=$4-lr;lr=$4;}
     $2 ~ /Com_select$/       {s=$4-ls;ls=$4;}
     $2 ~ /Com_update$/       {u=$4-lu;lu=$4;}
     $2 ~ /Com_insert$/       {i=$4-li;li=$4;}
     $2 ~ /Com_delete$/       {d=$4-ld;ld=$4;}
     $2 ~ /Innodb_rows_read$/       {irr=$4-lirr;lirr=$4;}
     $2 ~ /Innodb_rows_deleted$/       {ird=$4-lird;lird=$4;}
     $2 ~ /Innodb_rows_inserted$/       {iri=$4-liri;liri=$4;}
     $2 ~ /Innodb_rows_updated$/       {iru=$4-liru;liru=$4;}
     $2 ~ /Innodb_buffer_pool_read_requests$/       {ibprr=$4-libprr;libprr=$4;}
     $2 ~ /Innodb_buffer_pool_reads$/       {ibpr=$4-libpr;libpr=$4;}
     $2 ~ /Threads_connected$/  {tc=$4;}
     $2 ~ /Threads_running$/    {tr=$4;
        if(local_switch==0)
                {local_switch=1; count=16}
        else {
                if(count>15) {
                    count=0;
                    print "----------------------------------------------------------------------------------------------------------------------------------------------- ";
                    print "-------- Time -------|  QPS | Commit Rollback TPS | select insert update delete |  read inserted updated deleted | logical physical | Tcon Trun";
                    print "----------------------------------------------------------------------------------------------------------------------------------------------- ";
                }else{
                    count+=1;
                    printf "%s | %-5d| %-6d %-7d %-5d| %-7d %-7d %-5d %-6d| %-7d %-7d %-7d %-7d| %-6d  %-9d| %-4d %-2d \n", strftime("%Y/%m/%d/ %H:%M:%S"),q,c,r,c+r,s,u,i,d,irr,ird,iri,iru,ibprr,ibpr,tc,tr;
                }
        }
}'

mysqladmin -uroot -h127.0.0.1 -P8032 -p'mysql' extended-status -i1 |\
awk -F"|" \
"BEGIN{ count=0; }"\
'{ if($2 ~ /Variable_name/ && ((++count)%20 == 1)){\
print "---------------------- - MySQL Command Status - -------------- Innodb Row Operation -------------- Buffer Pool Read--" ; \
print "--------Time----------|---Qps---|select insert  update delete|   read inserted updated deleted|   logical    physical";\
}\
else if ($2 ~ /Queries /){queries=$3;}\
else if ($2 ~ /Com_select /) {com_select=$3;}\
else if ($2 ~ /Com_insert /) {com_insert=$3;}\
else if ($2 ~ /Com_update /) {com_update=$3;}\
else if ($2 ~ /Com_delete /) {com_delete=$3;}\
else if ($2 ~ /Innodb_rows_read /) {innodb_rows_read=$3;}\
else if ($2 ~ /Innodb_rows_updated /) {innodb_rows_updated=$3;}\
else if ($2 ~ /Innodb_rows_deleted /) {innodb_rows_deleted=$3;}\
else if ($2 ~ /Innodb_rows_inserted /) {innodb_rows_inserted=$3;}\
else if ($2 ~ /Innodb_buffer_pool_read_requests /) {innodb_lor=$3;}\
else if ($2 ~ /Innodb_buffer_pool_reads /) {innodb_phr=$3;}\
else if ($2 ~ /Uptime / && count >= 2) {\
  printf(" %s |%9d",strftime ("%Y/%m/%d/ %H:%M:%S") , queries);\
  printf("|%6d %6d %6d %6d", com_select, com_insert, com_update, com_delete);\
  printf("|%6d %8d %7d %7d", innodb_rows_read, innodb_rows_inserted, innodb_rows_updated, innodb_rows_deleted );\
  printf("|%10d %11d\n", innodb_lor,innodb_phr);\
}}'
```

### Ref

[查看mysql数据库容量大小](https://www.cnblogs.com/--smile/p/11451238.html)

Have a good work&life! 2023/01 via LinHong


