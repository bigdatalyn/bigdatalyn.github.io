$(function(){function o(){var o=setInterval(function(){if(document.getElementById("csdn-toolbar")){clearInterval(o),d=document.getElementById("csdn-toolbar").offsetHeight;var e=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;e-l>0&&e<n-t&&t>0?a.css({position:"fixed","z-index":"999",left:s+"px",top:d,width:i}):a.css({position:"unset","z-index":"10",left:"0px",top:"0",width:i})}},100)}var e=window.location.href;if(e.indexOf("category_")>-1){var a=$("#column .column_info_box"),n=$("#column .column_article_list").height(),t=$("#column .column_article_list li").length?$("#column .column_article_list li").height():0,c=document.getElementsByTagName("main")[0],s=c.offsetLeft,i=c.offsetWidth,l=document.getElementsByTagName("header")[0].offsetHeight,d=0;o(),$(window).scroll(function(){o()}),$(window).resize(function(){s=c.offsetLeft,i=c.offsetWidth,o()})}}),$(function(){function o(){N="https://csdnimg.cn/release/download/images/pay_error.png",j="已扫码<br>请在手机端操作",$("#payCode").html('<div class="renovate"><img src="'+N+'"><span>'+j+"</span></div>"),$("#payCodeImg").html('<img class="repeat-again" src="'+N+'"><span class="text">'+j+"</span>")}function e(e){var s={goods_id:e,product_id:e,flag:17,request_type:4,is_use_balance:h,coupon_key:C,sale_source:k,success_function:a,error_function:t,timeout_function:c,get_pay_success_callback:n,payment_function:o};$("#payCode").html(z),$("#payCodeImg").html(U),cart.qrPay(s)}function a(o,e){B?d("payCode",e.pay_url):d("payCodeImg",e.pay_url),v=e.pay_url}function n(){I.boxshadow.fadeOut(function(){showToast({text:"支付成功",bottom:"10%",zindex:9e3,speed:500,time:1500}),window.location.reload(),I.payCode.fadeOut(function(){window.location.reload()})})}function t(o){showToast({text:o.errorMessage,bottom:"10%",zindex:9e3,speed:500,time:1500})}function c(){B?I.payCode.find("#payCode").html(E):I.getPay.find("#payCodeImg").html(F)}function s(o,e){var a=Number(o)-Number(e);return a>0?a.toFixed(2):a<0?a.toFixed(2):a}function i(o){$.ajax({type:"GET",url:"https://mall.csdn.net/mp/mallorder/api/internal/goods/getGoodsInfo?goods_id="+o+"&product_id="+o+"&flag=17",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(a){w=a.data.available_amount,a.data.coupon_discount&&a.data.coupon_key&&(_=1*a.data.coupon_discount,C=a.data.coupon_key),S++,S<=1&&(0==w?(h=0,$(".pay-code-radio").prop("disabled",!0)):s(P,_)>0?(h=1,$(".pay-code-radio").attr("data-flag","true"),$(".pay-code-radio").prop("checked",!0)):(h=0,$(".pay-code-radio").prop("disabled",!0))),$(".pay-balance .balance").text(w),$(".pay-code-balance .balance").text(w),l(),e(o)}})}function l(){$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"block"}),_?(s(P,_)>0?h?(s(s(P,_),w)>0?($(".available-balance-0").text("¥"+w),$(".available-balance-1").text("¥"+s(s(P,_),w))):($(".available-balance-0").text("¥"+s(P,_)),$(".available-balance-1").text("¥0")),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".available-balance-1").text("¥"+s(P,_)),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".available-balance-1").text("¥0"),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})),$(".coupons-box .coupons-money").html("¥"+_),$(".coupons-box").fadeIn()):h?(s(P,w)>0?($(".available-balance-0").text("¥"+w),$(".available-balance-1").text("¥"+s(P,w))):($(".available-balance-0").text("¥"+P),$(".available-balance-1").text("¥0")),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".now-price").text("¥"+P),$(".subscribe-available-balance").css({display:"none"}),$(".subscribe-price-box").css({display:"block"}))}function d(o,e){var a=qrcode(6,"M");a.addData(e),a.make(),$("#"+o).html(a.createImgTag(3,3)),$("#"+o).html($("#"+o).html()),B&&I.boxshadow.fadeIn(function(){I.payCode.fadeIn()})}function u(o){if("popup"==o)window.csdn&&window.csdn.userOrderTip&&window.csdn.userOrderTip.show({tabs:["superVipForPopup"]});else{var e=document.createElement("a");e.style.display="none",e.href="https://mall.csdn.net/vip?vipSource=learningVip",e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}function r(){$.ajax({type:"GET",url:blogUrl+"phoenix/web/get-column-student-ab-test",dataType:"json",xhrFields:{withCredentials:!0},success:function(o){u(200==o.code?o.data:"control")},error:function(o){u("control")}})}function p(){var o=$(this),e=o.data("id");if(o.data("type"))var a=blogUrl+"phoenix/web/v1/subscribe/un-subscribe-study?columnId="+e;else var a=blogUrl+"phoenix/web/v1/subscribe/subscribe-study?columnId="+e;getCookie("UserName")?$.ajax({url:a,type:"post",dataType:"json",xhrFields:{withCredentials:!0},success:function(e){200==e.code&&e.data.status?o.data("type")?O.indexOf("/article/details/")>-1?window.location.reload():($(".studyvip-unsubscribe").css("display","inline-block"),$(".studyvip-subscribe").css("display","none")):O.indexOf("/article/details/")>-1?window.location.reload():($(".studyvip-subscribe").css("display","inline-block"),$(".studyvip-unsubscribe").css("display","none")):showToast({text:e.data.msg||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(o){showToast({text:o.data.msg||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}}):window.csdn.loginBox.show()}function b(o){var e=new RegExp("(^|&)"+o+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(e);return null!=a?unescape(a[2]):""}function m(o){window.csdn&&window.csdn.userOrderPayment&&window.csdn.userOrderPayment.show({params:[{flag:17,goodsId:o,productId:o}]})}function f(o,e){if(o.show){var a='<div class="column_coupon_main '+(o.receive?"active":"")+'">                <img class="column_coupon_icon" src="'+o.activityIcon+'" alt="">                <div class="column_coupon_text">                <span class="column_coupon_l">'+o.couponDesc+'</span>                <span class="column_coupon_m"></span>                <span class="column_coupon_r" data-couponId="'+o.groupNumber+'" data-columnId="'+e+'">'+(o.receive?"已领取":"立即领取")+"</span>                </div>            </div>";I.columnCouponBox.html(a),I.columnCouponBox.css({display:"flex"})}}function g(o,e,a){$.ajax({type:"GET",url:blogUrl+o,dataType:"json",xhrFields:{withCredentials:!0},data:{columnId:a},success:function(o){200==o.code?f(o.data,a):e.remove()},error:function(o){e.remove()}})}function x(o,e,a){$.ajax({type:"GET",url:blogUrl+o,dataType:"json",xhrFields:{withCredentials:!0},data:{columnId:a},success:function(n){200==n.code?n.data?(e.find(".column_coupon_main").addClass("active"),e.find(".column_coupon_r").html("已领取"),B?m(a):i(a)):setTimeout(function(){x(o,e,a)},500):showToast({text:n.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(o){showToast({text:o.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}})}function y(o,e,a){$.ajax({url:blogUrl+o,type:"post",dataType:"json",data:{columnId:a,groupNumber:e},xhrFields:{withCredentials:!0},success:function(o){200==o.code&&o.data?x(I.columnCouponStatus,I.columnCouponBox,a):showToast({text:o.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(o){showToast({text:o.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}})}var h=0,w=0,v="",C="",_=0,k="";$(document).on("click",".tip-subscribe-column>span",function(){$(this).parent().find(".tip").fadeIn()}),$(document).on("click",".tip-subscribe-column .bt-close",function(){$(".tip-subscribe-column").find(".tip").fadeOut()});var T="",I={boxshadow:$(".skin-boxshadow"),btClose:$(".bt-close"),payCode:$(".pay-code"),btSubscribe:$(".bt-subscribe-article"),btSubscribeColumn:$(".bt-subscribe-text"),getPay:$(".get-pay"),columnCouponBox:$("#columnCouponBox"),columnCouponCheck:"phoenix/web/v1/coupon/check-column-coupon",columnCouponStatus:"phoenix/web/v1/coupon/get-column-coupon-status",columnCouponLook:"phoenix/web/v1/coupon/get-column-coupon"},B=!1,O=window.location.href;O.indexOf("category_")>-1&&(I.columnCouponBox.length&&(T=I.columnCouponBox.data("id"),g(I.columnCouponCheck,I.columnCouponBox,T)),I.getPay.length&&(B=!1,T=I.getPay.data("id"),getCookie("UserName")&&(k=b("sale_source"),i(T)))),O.indexOf("/article/details/")>-1&&I.columnCouponBox.length&&(B=!0,T=I.columnCouponBox.data("id"),g(I.columnCouponCheck,I.columnCouponBox,T)),$(document).on("click",".bt-subscribe",function(){getCookie("UserName")||window.csdn.loginBox.show()}),I.getPay.on("click",function(){B=!1,T=$(this).data("id"),e(T)}),I.payCode.on("click",".renovate",function(){e(T||$(this).parent().data("id"))}),I.btClose.on("click",function(){I.payCode.fadeOut(function(){I.boxshadow.fadeOut()})});var N=blogStaticHost+"dist/pc/img/pay-time-out.png",j="获取中",U='<img class="repeat-again" src="'+N+'"><span class="text">'+j+"</span>",z='<div class="renov-men"><img src="'+N+'"><span>'+j+"</span></div>",E='<div class="renovate">    <img src="'+blogStaticHost+'dist/pc/img/pay-time-out.png">    <span>点击重新获取</span></div>',F='<img class="repeat-again" src="'+blogStaticHost+'dist/pc/img/pay-time-out.png"><span class="text">点击重新获取</span>';$(".now-price").text();$(".pay-code-radio").click(function(){var o=$(this).attr("data-flag");"true"==o?(h=0,$(this).attr("data-flag","false"),$(this).prop("checked",!1)):(h=1,$(this).attr("data-flag","true"),$(this).prop("checked",!0)),i(T)});var P=$(".subscribe-price .now-price").text().slice(1),S=0;I.payCode.on("click",".blance-bt",function(){window.open(v)}),$(document).on("click",".articleColumnBt",function(){if(getCookie("UserName")){var o=$(this).data("id");m(o)}else window.csdn.loginBox.show({spm:"1001.2101.3001.8610"})}),$(document).on("click",".column-studyvip-pass",function(){getCookie("UserName")?r():window.csdn.loginBox.show()}),$(document).on("click",".column-studyvip-ajax",p),$(document).on("click","#columnCouponBox",function(o){if(getCookie("UserName")){if("column_coupon_r"==o.target.className&&!$(this).find(".column_coupon_main").hasClass("active")){var e=o.target.dataset.couponid,a=o.target.dataset.columnid;y(I.columnCouponLook,e,a)}}else window.csdn.loginBox.show()})});