ğŸ”¹ ä½¿ç”¨åˆ°çš„æŒ‡ä»¤
å®‰è£åµŒå…¥æ¨¡å‹ï¼šollama pull mxbai-embed-large
å®‰è£è¯ç™¼ç§‘LLMæ¨¡å‹ï¼šollama run ycchen/breeze-7b-instruct-v1_0
å®‰è£chromadb(å‘é‡åº«)ï¼špip install chromadb

ğŸ”¹ ç¨‹å¼ç¢¼Code

import streamlit as st  # å°å…¥Streamlitåº«ï¼Œç”¨æ–¼å»ºç«‹ç¶²é æ‡‰ç”¨
import ollama  # å°å…¥ollamaåº«ï¼Œç”¨æ–¼è‡ªç„¶èªè¨€è™•ç†
import chromadb  # å°å…¥chromadbåº«ï¼Œç”¨æ–¼æ•¸æ“šå­˜å„²å’ŒæŸ¥è©¢
import pandas as pd  # å°å…¥pandasåº«ï¼Œç”¨æ–¼æ•¸æ“šåˆ†æå’Œè™•ç†

å®šç¾©ä¸€å€‹åˆå§‹åŒ–å‡½æ•¸ï¼Œç”¨æ–¼è¨­ç½®Streamlitçš„æœƒè©±ç‹€æ…‹
def initialize():
    æª¢æŸ¥'session_state'ï¼ˆæœƒè©±ç‹€æ…‹ï¼‰ä¸­æ˜¯å¦å·²æœ‰'already_executed'é€™å€‹è®Šé‡
    é€™å€‹è®Šé‡ç”¨ä¾†æª¢æŸ¥æ˜¯å¦å·²ç¶“é€²è¡Œéä¸€æ¬¡è³‡æ–™åº«åˆå§‹åŒ–æ“ä½œ
    if "already_executed" not in st.session_state:
        st.session_state.already_executed = False  # è‹¥ä¸å­˜åœ¨ï¼Œå‰‡è¨­ç½®ç‚ºFalse

    å¦‚æœ'already_executed'ç‚ºFalseï¼Œè¡¨ç¤ºé‚„æœªåˆå§‹åŒ–éè³‡æ–™åº«
    if not st.session_state.already_executed:
        setup_database()  # å‘¼å«setup_databaseå‡½æ•¸ä¾†é€²è¡Œè³‡æ–™åº«çš„è¨­ç½®å’Œæ•¸æ“šåŠ è¼‰

å®šç¾©è¨­ç½®è³‡æ–™åº«çš„å‡½æ•¸
def setup_database():
    client = chromadb.Client()  # å‰µå»ºä¸€å€‹chromadbçš„å®¢æˆ¶ç«¯ï¼Œç”¨æ–¼èˆ‡è³‡æ–™åº«äº¤äº’
    file_path = 'QA50.xlsx'  # æŒ‡å®šExcelæ–‡ä»¶çš„è·¯å¾‘å’Œåç¨±
    documents = pd.read_excel(file_path, header=None)  # ä½¿ç”¨pandasè®€å–Excelæ–‡ä»¶

    ä½¿ç”¨chromadbå®¢æˆ¶ç«¯å‰µå»ºæˆ–ç²å–åç‚º'demodocs'çš„é›†åˆ
    collection = client.get_or_create_collection(name="demodocs")

    éæ­·å¾Excelæ–‡ä»¶ä¸­è®€å–çš„æ•¸æ“šï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€æ¢è¨˜éŒ„
    for index, content in documents.iterrows():
        response = ollama.embeddings(model="mxbai-embed-large", prompt=content[0])  # é€šéollamaç”Ÿæˆè©²è¡Œæ–‡æœ¬çš„åµŒå…¥å‘é‡
        collection.add(ids=[str(index)], embeddings=[response["embedding"]], documents=[content[0]])  # å°‡æ–‡æœ¬å’Œå…¶åµŒå…¥å‘é‡æ·»åŠ åˆ°é›†åˆä¸­

    st.session_state.already_executed = True  # è¨­ç½®'already_executed'ç‚ºTrueï¼Œè¡¨ç¤ºå·²å®Œæˆåˆå§‹åŒ–
    st.session_state.collection = collection  # å°‡é›†åˆä¿å­˜åœ¨æœƒè©±ç‹€æ…‹ä¸­ï¼Œä¾›å¾ŒçºŒä½¿ç”¨    


å®šç¾©å‰µå»ºæ–°chromadbå®¢æˆ¶ç«¯çš„å‡½æ•¸ï¼Œæ¯æ¬¡éœ€è¦æ™‚å‰µå»ºæ–°çš„é€£æ¥
def create_chromadb_client():
    return chromadb.Client()  # è¿”å›ä¸€å€‹æ–°çš„chromadbå®¢æˆ¶ç«¯å¯¦ä¾‹

ä¸»å‡½æ•¸ï¼Œè² è²¬æ§‹å»ºUIå’Œè™•ç†ç”¨æˆ¶äº‹ä»¶
def main():
    initialize()  # å‘¼å«åˆå§‹åŒ–å‡½æ•¸
    st.title("æˆ‘çš„ç¬¬ä¸€å€‹LLM+RAGæœ¬åœ°çŸ¥è­˜å•ç­”")  # åœ¨ç¶²é æ‡‰ç”¨ä¸­è¨­ç½®æ¨™é¡Œ
    user_input = st.text_area("æ‚¨æƒ³å•ä»€éº¼ï¼Ÿ", "")  # å‰µå»ºä¸€å€‹æ–‡æœ¬å€åŸŸä¾›ç”¨æˆ¶è¼¸å…¥å•é¡Œ

    å¦‚æœç”¨æˆ¶é»æ“Š"é€å‡º"æŒ‰éˆ•
    if st.button("é€å‡º"):
        if user_input:
            handle_user_input(user_input, st.session_state.collection)  # è™•ç†ç”¨æˆ¶è¼¸å…¥ï¼Œé€²è¡ŒæŸ¥è©¢å’Œå›ç­”
        else:
            st.warning("è«‹è¼¸å…¥å•é¡Œï¼")  # å¦‚æœç”¨æˆ¶æ²’æœ‰è¼¸å…¥ï¼Œé¡¯ç¤ºè­¦å‘Šæ¶ˆæ¯

å®šç¾©è™•ç†ç”¨æˆ¶è¼¸å…¥çš„å‡½æ•¸
def handle_user_input(user_input, collection):
    response = ollama.embeddings(prompt=user_input, model="mxbai-embed-large")  # ç”Ÿæˆç”¨æˆ¶è¼¸å…¥çš„åµŒå…¥å‘é‡
    results = collection.query(query_embeddings=[response["embedding"]], n_results=3)  # åœ¨é›†åˆä¸­æŸ¥è©¢æœ€ç›¸é—œçš„ä¸‰å€‹æ–‡æª”
    data = results['documents'][0]  # ç²å–æœ€ç›¸é—œçš„æ–‡æª”
    output = ollama.generate(
        model="ycchen/breeze-7b-instruct-v1_0",
        prompt=f"Using this data: {data}. Respond to this prompt and use chinese: {user_input}"  # ç”Ÿæˆå›æ‡‰
    )
    st.text("å›ç­”ï¼š")  # é¡¯ç¤º"å›ç­”ï¼š"
    st.write(output['response'])  # å°‡ç”Ÿæˆçš„å›æ‡‰é¡¯ç¤ºåœ¨ç¶²é ä¸Š

if _name_ == "__main__":
    main()  # å¦‚æœç›´æ¥åŸ·è¡Œæ­¤æ–‡ä»¶ï¼Œå‰‡åŸ·è¡Œmainå‡½æ•¸
